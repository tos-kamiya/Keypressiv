<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
        <link rel="stylesheet" href="css/html5reset.css">
        <link rel="stylesheet" href="css/fontsettings.css">
        <script src="js/jquery.min.js"></script>
        <script src="js/flowtype-mod.js"></script>
        <script src="js/jquery.hammer.js"></script>
        <script src="brython/brython.js"></script>
        <script type="text/javascript">
            $(function() {
                brython();
                $('#zone').flowtype();
                makeBodyFullWindowSize = function() {
                    $('body').css({ 'width': $(window).width(), 'height': $(window).height() });
                };
                makeBodyFullWindowSize();
                $(window).resize(function(){ makeBodyFullWindowSize();});
            });
        </script>

        <!-- Optional: google-code-prettify, a syntax highlighter -->
        <link href="google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="google-code-prettify/prettify.js"></script>

        <!-- Optional: title of slide -->
        <title></title>
    </head>
    <body>
        <div id='zone'>
        </div>
        <script type="text/python">
            import markdown

            def read_pages(presentation_file):
                lines = open(presentation_file).readlines()
                pages = []
                pls = []
                for L in lines:
                    if L.startswith("!SLIDE"):
                        if pls:
                            pages.append('\n'.join(pls))
                        pls = []
                    else:
                        pls.append(L)
                if pls:
                    pages.append('\n'.join(pls))
                return pages
            
            def show_page(page_text):
                mk, scripts = markdown.mark(page_text)
                doc['zone'].html = mk
                for script in scripts:
                    exec(script,globals())
                prettyPrint() # optional, google-code-prettify
            
            pages = read_pages("presentation.md")
            cur_page_index = [0]
            cur_typing_number = [0]

            show_page(pages[0])

            def move_page(delta):
                cur_typing_number[0] = 0
                i = cur_page_index[0]
                s = len(pages)
                i += delta
                i = max(0, min(i, s - 1))
                show_page(pages[i])
                cur_page_index[0] = i

            def do_keydown(e):
                kc = e.keyCode
                if 37 <= kc <= 40:
                    if kc in (37, 38):
                        move_page(-1)
                    elif kc in (39, 40):
                        move_page(1)
                elif 48 <= kc <= 57:
                    cur_typing_number[0] = cur_typing_number[0] * 10 + (kc - 48)
                elif 96 <= kc <= 105:
                    cur_typing_number[0] = cur_typing_number[0] * 10 + (kc - 96)
                elif kc == 13:
                    i = cur_typing_number[0] - 1
                    s = len(pages)
                    i = max(0, min(i, s - 1))
                    show_page(pages[i])
                    cur_page_index[0] = i
                    cur_typing_number[0] = 0
            doc.bind('keydown', do_keydown)
        </script>
        <script>
            $("body").hammer({ "swipe_velocity": 0.5 })
                    .on("release swipeleft swiperight", function(ev) {
                switch(ev.type) {
                    case 'swipeleft':
                        move_page(1);
                        ev.gesture.stopDetect();
                        break;
                   case 'swiperight':
                        move_page(-1);
                        ev.gesture.stopDetect();
                        break;
                }
            });
        </script>
    </body>
</html>

