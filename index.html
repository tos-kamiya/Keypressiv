<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
        <link rel="stylesheet" href="css/html5reset.css">
        <link rel="stylesheet" href="css/fontsettings.css">
        <link rel="stylesheet" href="css/animation.css">
        <script src="js/jquery.min.js"></script>
        <script src="js/flowtype-mod.js"></script>
        <script src="js/jquery.hammer.min.js"></script>
        <script src="js/animation.js"></script>
        <script src="brython/brython.js"></script>
        <script type="text/javascript">
            $(function() {
                brython();
                var resizeElements = function() {
                    $('body').css({ 'width': $(window).width(), 'height': $(window).height() });
                    $('#zone0').flowtype();
                    $('#zone1').flowtype();
                    $('#slidefooter-page,#slidefooter-text').flowtype({ "onlyFontResizing": true });
                };
                resizeElements();
                $(window).resize(function(){ resizeElements(); });
            });
        </script>
        <style>
            div#slidefooter-page {
                position: fixed;
                bottom: 0;
                z-index: -2;
            }
            div#slidefooter-text {
                position: fixed;
                bottom: 0;
                z-index: -2;
            }
        </style>

        <!-- Optional: google-code-prettify, a syntax highlighter -->
        <link href="google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="google-code-prettify/prettify.js"></script>

        <!-- Optional: title of slide -->
        <title></title>
    </head>
    <body style="position:relative;overflow:hidden;">
        <div id="slidefooter-page"></div>
        <div id="slidefooter-text"></div>
        <div id='zone0'>
        </div>
        <div id='zone1' style="display:none;">
        </div>
        <script type="text/python">
            import html
            from slidelib import read_pages

            def get_hash_num():
                if doc.location.hash:
                    h = doc.location.hash[1:]
                    try:
                        i = int(h)
                        return i
                    except:
                        pass
                return None

            def set_hash_num(n):
                doc.location.hash = n

            def draw_page(zone_id, page_data, confing_data):
                mk, scripts = page_data
                doc[zone_id].html = mk
                for script in scripts:
                    exec(script, globals())
                prettyPrint() # optional, google-code-prettify
                page_num = confing_data['page']
                doc["slidefooter-page"].text = page_num
                op = 1 if page_num > 1 or confing_data.get("show-footer-in-title-page") else 0
                doc["slidefooter-text"].style.opacity = doc["slidefooter-page"].style.opacity = op

            pages, config_data = read_pages("presentation.md")
            doc["slidefooter-text"].text = config_data.get("footer-text", "")

            n = get_hash_num()
            i = max(0, min(n - 1, len(pages) - 1)) if n is not None else 0
            cur_page_index = [i]
            cur_typing_number = [0]
            cur_zone_index = [0]

            i = cur_page_index[0]
            config_data.update({ "page": i + 1 })
            draw_page('zone%d' % cur_zone_index[0], pages[i], config_data)
            set_hash_num(i + 1)

            def move_page(delta):
                if delta == 0:
                    return
                cur_typing_number[0] = 0
                previ = i = cur_page_index[0]
                i += delta
                i = max(0, min(i, len(pages) - 1))
                if i == previ:
                    return
                config_data.update({ "page": i + 1 })
                zi = (cur_zone_index[0] + 1) % 2
                czid = 'zone%d' % cur_zone_index[0]
                nzid = 'zone%d' % zi
                draw_page(nzid, pages[i], config_data)
                if -1 <= delta <= 1:
                    set_sliding_animation(nzid, czid, ("right" if delta > 0 else "left"))
                else:
                    set_no_animation(nzid, czid)
                cur_page_index[0] = i
                cur_zone_index[0] = zi
                set_hash_num(i + 1)

            def do_keydown(e):
                kc = e.keyCode
                if 37 <= kc <= 40:
                    if kc in (37, 38):
                        move_page(-1)
                    elif kc in (39, 40):
                        move_page(1)
                elif 48 <= kc <= 57:
                    cur_typing_number[0] = cur_typing_number[0] * 10 + (kc - 48)
                elif 96 <= kc <= 105:
                    cur_typing_number[0] = cur_typing_number[0] * 10 + (kc - 96)
                elif kc == 13:
                    n = cur_typing_number[0]
                    if n > 0:
                        i = cur_typing_number[0] - 1
                        s = len(pages)
                        i = max(0, min(i, s - 1))
                        move_page(i - cur_page_index[0])
                        cur_typing_number[0] = 0
                    else:
                        return False
                else:
                    return False
                return True  # consume event
            doc.bind('keydown', do_keydown)
            
            def do_hashchange():
                n = get_hash_num()
                if n is not None:
                    i = max(0, min(n - 1, len(pages) - 1))
                    move_page(i - cur_page_index[0])
        </script>
        <script>
            $(window).on('hashchange', function () {
                do_hashchange();
            });
            $("body").hammer({ "swipe_velocity": 0.5 })
                    .on("release swipeleft swiperight", function(ev) {
                switch(ev.type) {
                    case 'swipeleft':
                        move_page(1);
                        ev.gesture.stopDetect();
                        break;
                   case 'swiperight':
                        move_page(-1);
                        ev.gesture.stopDetect();
                        break;
                }
            });
        </script>
    </body>
</html>

